#@myLayout() #define main()


<div class="row">
	<div class="col-xs-12">
		<div class="box">
			<div class="box-header">
				<h3 class="box-title">备货接收表</h3>
				<div class="box-tools">
					<form action="/fy/admin/biz/addition/ready/receiveReady"  class="form-inline">
						 <div class="form-group  input-group-sm">
						    <label for="condition">条件</label>
							    <select id="condition" class="form-control" name="condition"   ">
							    	<option #if(condition=="work_order_no") selected="selected" #end value="work_order_no">工作订单号</option>
							    	<option #if(condition=="commodity_name") selected="selected" #end value="commodity_name">产品名称</option>
							    	<option #if(condition=="map_no") selected="selected" #end value="map_no">图号</option> 
							    	<option #if(condition=="ready_status") selected="selected" #end value="ready_status">备货状态</option> 	
							    </select>
						  </div>
						  
						
						   <div id="keyword_div" class="form-group  input-group-sm" >

							<input id="keyword" type="text" name="keyWord" autocomplete="off" class="form-control"  value="#(keyWord)">
						  
						  </div>
						  <input type="text" name="modelId" hidden="hidden" value="#(modelId)">
						  
						  <div class="form-group  input-group-sm">
						  	<button type="submit" class="btn btn-default">
									<i class="fa fa-search"></i>
								</button>
						  </div>
						 </form>
				</div>
			</div>
			<!-- /.box-header -->
			<div id="div_table" class="box-body table-responsive no-padding">
	
					<table class="table table-bordered text-center"  style="white-space:nowrap">
						<thead>
							<tr >
								<th style="">序号</th>
								
								<th>类别</th>
								<th>计划员</th>
								<th>执行状态</th>
								<th>客户编码</th>
								<th>订单日期</th>
								<th>交货日期</th>
								<th>工作订单号</th>
								<th>送货单号</th>
								<th>商品名称</th>
								<th>图号</th>
								<th>总图号</th>
								<th>技术条件</th>
								<th>质量等级</th>
								<th>数量</th>
								<th>单位</th>
						
								<th>分配流向</th>
								<th>分配属性</th>
								<th>分配时间</th>
								
								<th>补单数量</th>
								<th>未补单数量</th>
								
								<th>操作</th>
							</tr>
						</thead>
						<tbody>
							#for(x : modelPage.getList())
							<tr >
								<td>#(for.index+1)</td>
							
								<td>#(x.cate_tmp)</td>
								<td>#(x.plan_tmp)</td>
								<td>#(x.execu_status)</td>
								<td>#(x.customer_no)</td>
								<td>#(x.order_date)</td>
								<td>#(x.delivery_date)</td>
								<td>#(x.work_order_no)</td>
								<td>#(x.delivery_no)</td>
								<td>#(x.commodity_name)</td>
								<td>#(x.map_no)</td>
								<td>#(x.total_map_no)</td>
								
								<td>#(x.technology)</td>
								<td>#(x.machining_require)</td>
								<td>#(x.quantity)</td>
								<td>#(x.unit_tmp)</td>
							
								<td>#(x.distribute_to)</td>
								<td>#(x.distribute_attr)</td>
								<td>#(x.distribute_time)</td>
								
								<th>#(x.add_quantity)</th>
								<th>#(x.unadd_quantity)</th>
								
								<td>
								
							
									#if(x.ready_order_id)
										#if(x.add_quantity!=x.quantity)
										<a data-id="#(x.id)"  name="addquantiy"> <i
											class="fa fa-hand-pointer-o" title="选择备货">补货</i>
										</a>
										#end
										<a style="margin-left: 10px"  data-map="#(x.map_no)"
										data-id="#(x.id)" name="rollback_ready" > <i class="fa  fa-chain" title="选择备货">撤回</i>
										</a>
									#else
										<a style="margin-left: 10px" data-title="#escape(x.name)" data-map="#(x.map_no)"
										data-id="#(x.id)" onclick="onSelectReady(this)" > <i
											class="fa  fa-chain" title="选择备货">选择备货</i>
										</a>
									#end
									
								
								</td>
							</tr>
							#end
						</tbody>
					</table>
		

			</div>
			<!-- /.box-body -->

			<div class="box-footer clearfix">
				#@myadminPaginate(modelPage.pageNumber, modelPage.totalPage,
				"/fy/admin/biz/addition/readyReceive?p=")</div>
				
				<div style="position:fixed ; bottom:20px;width:50%;right: 20px" >
				<input id="ex6" type="text" data-slider-min="0"  data-slider-step="1" data-slider-value="0" style="width: 100%"/>  
			 <script type="text/javascript">
			 //data-slider-max="100"
				 $(function(){
					 var lenth= $("#div_table").get(0).scrollWidth -$("#div_table").width();
					var ex6 =  $("#ex6");
					ex6.slider({
						max:lenth
					});
					 $("#ex6").on("slide", function(slideEvt) {
						 var withSize = $("#div_table").width();
						 $("#div_table").scrollLeft(slideEvt.value);
					 	  
					 	
					 });
					 
					 var div_table=  $("#div_table");
					 div_table.scroll(function(){
 
						var scrollLeft =  $(this).scrollLeft();
					//	 console.info("scrollLeft : "+ scrollLeft);
						$("#ex6").slider('setValue', scrollLeft);
					 
					 });
				 });
			
			 </script>
			 </div>
				
		</div>
		<!-- /.box -->
	</div>
</div>
#include("searchReady.html")
<script type="text/javascript">
	
/**
 * 多个分配
 */
 	function onSelectReady(a){
		var callback =function(select,id,name){
			console.info(select+" "+id+" "+name);
			if(select){
				$.ajax({
					   type: "POST",
					   url:'/fy/admin/biz/addition/readyReceive/addToReady' ,
					   data:{add_order_id:$("#ReadyKeyWord").data('id'),ready_order_id:id},
					   success: function(ret){
						   if (ret.state == "ok") {
							
							   location.reload();
							}
						   alert(ret.msg);
					   },
					   error:function (XMLHttpRequest, textStatus, errorThrown) {
						    // 通常 textStatus 和 errorThrown 之中
						    // 只有一个会包含信息
						 //   this; // 调用本次AJAX请求时传递的options参数
						   alert('网络异常');
						}
					});
			}else{
				
			}
		};
		new SelectReadyModal(callback,a).show();
	
	}
	
	


</script>

#include("addquantityModel.html")
<script type="text/javascript">
	$(function(){
		$("a[name='addquantiy']").click(function(){
		//	console.info("tehs");
			var order_id= $(this).data('id');
			var callback=function(){
				console.info(" 添加备货 callback");
			}
			var addQauntityModel =	new AddQauntityModel(callback,order_id);
			addQauntityModel.show();
		});
		
		$("a[name='rollback_ready']").click(function(){
		
			var order_id= $(this).data('id'); 
			console.info("撤回 "+order_id);
			var sure = confirm("确定要撤回吗?")
			if(sure){
				//撤回
				$.ajax({
					   type: "POST",
					   url:'/fy/admin/biz/addition/readyReceive/rollback' ,
					   data:{order_id:order_id},
					   success: function(ret){
						   alert(ret.msg);
						   if (ret.state == "ok") {
							   location.reload();
							}
						
					   },
					   error:function (XMLHttpRequest, textStatus, errorThrown) {
						    // 通常 textStatus 和 errorThrown 之中
						    // 只有一个会包含信息
						 //   this; // 调用本次AJAX请求时传递的options参数
						   alert('网络异常');
						}
					});
			}else{
				
			}
		});
	});
</script>
#end
