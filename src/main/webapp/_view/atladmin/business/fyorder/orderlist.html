#@myLayout() #define main()


<div class="row">
	<div class="col-xs-12">
		<div class="box">
			<div class="box-header">
				<h3 class="box-title text-center" >订单管理</h3>
				#fypermession("order_upload")
					#include("upload.html")
				#end
				<div class="box-tools">
			
					<form action="/fy/admin/biz/fyorder"  class="form-inline">
						 <div class="form-group  input-group-sm">
						 	    <label for="condition">显示</label>
						 	   	<select id="condition" class="form-control" name="pageSize" >
						 	   			<option  value="10">10</option>
						 	   			<option  value="20" #if(pageSize == 20) selected="selected" #end >20</option>
						 	   			<option  value="30" #if(pageSize == 30) selected="selected" #end >30</option>
						 	   			<option  value="50" #if(pageSize == 50) selected="selected" #end >50</option>
						 	   			<option  value="100" #if(pageSize == 1000) selected="selected" #end >100</option>
						 	   	</select>
						 </div>
						 <div class="form-group  input-group-sm">
						    <label for="condition">条件</label>
							    <select id="condition" class="form-control" name="condition" onselect="" onchange="onselectCondition()">
							    	<option #if(condition=="cate_tmp") selected="selected" #end value="cate_tmp">类别</option>
							    	<option #if(condition=="order_date") selected="selected" #end value="order_date">订单日期</option>
							    	<option #if(condition=="work_order_no") selected="selected" #end value="work_order_no" >工作订单号</option>
							    	<option #if(condition=="commodity_spec") selected="selected" #end value="commodity_spec">商品规格</option>
							    	<option #if(condition=="dis_warn") selected="selected" #end value="commodity_spec">分配预警</option>
							    	<option #if(condition=="delay_warn") selected="selected" #end value="commodity_spec">交货预警</option>
							    	<option #if(condition=="delay") selected="selected" #end value="commodity_spec">拖期</option>
							    </select>
						  
						  </div>
						  
						 <div id="order_date_div" class="form-group  input-group-sm" #if(condition!="order_date") style="display:none;" #end  >

							<input id="order_date" type="text" name="order_date" value="#(order_date)"  autocomplete="off" class="form-control"  data-type='datepicker' >
						  
						  </div>
						  
						
						   <div id="keyword_div" class="form-group  input-group-sm"  #if(condition=="order_date") style="display:none;" #end  >

							<input id="order_date" type="text" name="keyWord" autocomplete="off" class="form-control"  value="#(keyWord)">
						  
						  </div>
						  
						  <div class="form-group  input-group-sm">
						  	<button type="submit" class="btn btn-default">
									<i class="fa fa-search"></i>
								</button>
						  </div>
						
  <script type="text/javascript">
	  function onselectCondition(){
	  		var val = $("#condition").val();
	  		if("order_date"==val){
	  			
	  			$("#order_date_div").css('display','inline');//visible
	  			$("#keyword_div").css('display','none');//visible
	  		}else{
	  			$("#keyword_div").css('display','inline');//visible
	  			$("#order_date_div").css('display','none');//visible
	  		}
	  }
						  	
</script>
					</form>
					
				</div>
			</div>
			<!-- /.box-header -->
			<div class="box-body table-responsive no-padding text-center">
	
					<table class="table table-bordered"  style="white-space:nowrap;margin-right: 5px;margin-left:5px;text-align:center" >
						<thead>
							<tr>
								<th>序号</th>
								#fyColPerm("order","category_id")
								<th>类别</th>
								#end
								
								#fyColPerm("order","planer_id")
								<th>计划员</th>
								#end
								
								#fyColPerm("order","execu_status")
								<th>执行状态</th>
								#end
								
								#fyColPerm("order","urgent_status")
								<th>紧急状态</th>
								#end
								
								#fyColPerm("order","bill_date")
								<th>订单日期</th>
								#end
								
								#fyColPerm("order","delivery_date")
								<th>交货日期</th>
								#end
								
								#fyColPerm("order","work_bill_no")
								<th>工作订单号</th>
								#end
								
								#fyColPerm("order","delivery_no")
								<th>送货单号</th>
								#end
								
								#fyColPerm("order","commodity_name")
								<th>商品名称</th>
								#end
								
								#fyColPerm("order","commodity_spec")
								<th>商品规格</th>
								#end
								
								#fyColPerm("order","map_no")
								<th>总图号</th>
								#end
								#fyColPerm("order","technology")
								<th>技术条件</th>
								#end
								
								#fyColPerm("order","machining_require")
								<th>加工要求</th>
								#end
								
								#fyColPerm("order","quantity")
								<th>数量</th>
								#end
								
								#fyColPerm("order","unit")
								<th>单位</th>
								#end
								
								#fyColPerm("order","untaxed_amount")
								<th>未税单价</th>
								#end
								
								#fyColPerm("order","Amount")
								<th>金额</th>
								#end
								
								#fyColPerm("order","tax")
								<th>税率</th>
								#end
								
								#fyColPerm("order","tax_amount")
								<th>税额</th>
								#end
								
								#fyColPerm("order","tatol_amount")
								<th>含税金额</th>
								#end
								
								#fyColPerm("order","inport_time")
								<th>导入时间</th>
								#end
								
								#fyColPerm("order","receive_time")
								<th>接收时间</th>
								#end
								
								#fyColPerm("order","distribute_time")
								<th>订单分配时间</th>
								#end
								
								#fyColPerm("order","warn_time")
								<th>分配预警时间</th>
								#end
								
								#fyColPerm("order","remark")
								<th>备注</th>
								#end
								
								#fyColPerm("order","draw")
								<th>图纸</th>
								#end
								
								#fyColPerm("order","hang_time")
								<th>挂账时间</th>
								#end
								
								#fyColPerm("order","hang_status")
								<th>挂账状态</th>
								#end
								
								#fyColPerm("order","hang_quantity")
								<th>挂账数量</th>
								#end
								
								#fyColPerm("order","hang_amount")
								<th>挂账金额</th>
								#end
								
								#fyColPerm("order","unhang_quantity")
								<th>未挂账数量</th>
								#end
								#fyColPerm("order","send_address")
								<th>送货地址</th>
								#end
								<th>操作</th>
							</tr>
						</thead>
						<tbody>
							#for(x : modelPage.getList())
							<tr class="#orderColor("x")">
								<td>#(for.index+1) </td>
								#fyColPerm("order","category_id")
								<td>#(x.cate_tmp)</td>  
								#end
								
								#fyColPerm("order","planer_id")
								<td>#(x.plan_tmp)</td>
								#end
								
								#fyColPerm("order","execu_status")
								<td>#(x.execuStatus)</td>
								#end
								
								#fyColPerm("order","urgent_status")
								<td>#(x.urgentStatus)</td>
								#end
								
								#fyColPerm("order","bill_date")
								<td>#(x.orderDate)</td>
								#end
								
								#fyColPerm("order","delivery_date")
								<td>#(x.deliveryDate)</td>
								#end
								#fyColPerm("order","work_bill_no")
								<td>#(x.workOrderNo)</td>
								#end
								
								#fyColPerm("order","delivery_no")
								<td>#(x.deliveryNo)</td>
								#end
								
								#fyColPerm("order","commodity_name")
								<td>#(x.commodityName)</td>
								#end
								
								#fyColPerm("order","commodity_spec")
								<td>#(x.commoditySpec)</td>
								#end
								
								#fyColPerm("order","map_no")
								<td>#(x.mapNo)</td>
								#end
								
								#fyColPerm("order","technology")
								<td>#(x.technology)</td>
								#end
								
								#fyColPerm("order","machining_require")
								<td>#(x.machiningRequire)</td>
								#end
								
								#fyColPerm("order","quantity")
								<td>#(x.quantity)</td>
								#end
								
								#fyColPerm("order","unit")
								<td>#(x.unit_tmp)</td>
								#end
								
								#fyColPerm("order","untaxed_amount")
								<td>#(x.untaxedCost)</td>
								#end
								
								#fyColPerm("order","Amount")
								<td>#(x.amount)</td>
								#end
								
								#fyColPerm("order","tax")
								<td>#taxRate(x.taxRate)</td>
								#end
								
								#fyColPerm("order","tax_amount")
								<td>#(x.tax_amount)</td>
								#end
								
								#fyColPerm("order","tatol_amount")
								<td>#(x.tatolAmount)</td>
								#end
								
								#fyColPerm("order","inport_time")
								<td>#date(x.import_time,"yyyy-MM-dd hh:mm:ss")</td>
								#end
								
								#fyColPerm("order","receive_time")
								<td name="receiveTime">#date(x.receiveTime,"yyyy-MM-dd hh:mm:ss")</td>
								#end
								
								#fyColPerm("order","distribute_time")
								
								<td>#(x.distributeTime)</td>
								#end
								
								#fyColPerm("order","warn_time")
								
								<td>#(x.warnTime)</td>
								#end
								
								#fyColPerm("order","remark")
								<td>#(x.remark)</td>
								#end
								
								#fyColPerm("order","draw")
								<td  data-id="#(x.id)">
										#if(x.filename) #(x.filename) #else
											<a href="#" onclick="showChooesFile(this)"> 
												<i class="glyphicon glyphicon-th-large" title="选择图纸"></i>
											</a>
		                               #end
								 </td>
								 #end
								 
								#fyColPerm("order","hang_time")
								<td>#(x.hangTime)</td>
								#end
								
								#fyColPerm("order","hang_status")
								<td>#(x.hangStatus)</td>
								#end
								
								#fyColPerm("order","hang_quantity")
								<td>#(x.uhang_quantity)</td>
								#end
								
								#fyColPerm("order","uhang_amount")
								<td>#(x.hang_account)</td>
								#end
								
								#fyColPerm("order","unhquantity")
								<td>#(x.unhang_quantity)</td>
								#end
								
								#fyColPerm("order","send_address")
								<td>#(x.send_address)</td>
								#end
								
					
								<td class="jfa-operation-button">
								
								#fypermession("order_update")
								<a href="#" onclick="showModel(this)" data-id="#(x.id)"> 
									<i class="glyphicon glyphicon-pencil" title="修改"></i>
								</a> 
								#end
								#fypermession("order_delete")
								<a href="#" onclick="deleteOrder(this)" data-id="#(x.id)" data-order-id="#(x.workOrderNo)"  style="color: red;margin-left: 10px"> 
									<i class="glyphicon glyphicon-trash" title="删除"></i>
								</a> 
								#end
								</td>
								
							</tr>
							#end
						</tbody>
					</table>
		

			</div>
			<!-- /.box-body -->

			<div class="box-footer clearfix">
				#@myadminPaginate(modelPage.pageNumber, modelPage.totalPage,
				"/fy/admin/biz/fyorder?p=")</div>
		</div>
		<!-- /.box -->
	</div>
</div>


<script type="text/javascript">
function receive(a){

		
		$.ajax({
			   type: "POST",
			   url:$(a).data("action"),
			   data:{id:$(a).data("id")},
			   success: function(ret){
				   if (ret.state == "ok") {
					 var td=  $(a).parent().parent().children("[name=receiveTime]");
					 td.text(ret.date)
					}
				   alert(ret.msg);
				   $(a).empty();
			   },
			   error:function (XMLHttpRequest, textStatus, errorThrown) {
				    // 通常 textStatus 和 errorThrown 之中
				    // 只有一个会包含信息
				 //   this; // 调用本次AJAX请求时传递的options参数
				   alert('网络异常');
				}
			});
}

function deleteOrder(a){
	var obj = $(a);
	var re = confirm("是否要删除订单 "+obj.data('order-id'));
	if(re){
		$.ajax({
			   type: "POST",
			   url:'/fy/admin/biz/fyorder/deleteOrder' ,
			   data:{id:$(a).data("id")},
			   success: function(ret){
				   if (ret.state == "ok") {
						location.reload();
					
					}
				   alert(ret.msg);
				   $(a).empty();
			   },
			   error:function (XMLHttpRequest, textStatus, errorThrown) {
				    // 通常 textStatus 和 errorThrown 之中
				    // 只有一个会包含信息
				 //   this; // 调用本次AJAX请求时传递的options参数
				   alert('网络异常');
				}
			});
	}
}



    </script>

#end
#include("../../file/listFileModel.html")
#include("editOrderModel.html")